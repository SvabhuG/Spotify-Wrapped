{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Your Spotify Wrapped" %}{% endblock %}

{% block extra_css %}
<style>
    /* Background for the entire page */
    body {
        background: linear-gradient(135deg, #1DB954, #191414);
        color: #ffffff;
    }

    /* Dark Mode Styles */
    body.dark-mode {
        background: linear-gradient(135deg, #191414, #1DB954);
        color: #cccccc;
    }

    /* Slider Container */
    .slider-container {
        position: relative;
        max-width: 900px;
        margin: 2em auto;
        overflow: hidden;
        background: #191414;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        padding: 2em;
        min-height: 450px;
    }

    /* Slide Styling */
    .slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: calc(100% - 50px); /* Adjusted to account for slide indicators */
        overflow-y: auto; /* Enables vertical scrolling */
        padding-bottom: 1em; /* Adds space at the bottom */
        opacity: 0;
        transform: translateX(100%);
        transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
    }

    .slide.active {
        opacity: 1;
        transform: translateX(0);
        z-index: 1;
    }

    .slide.inactive {
        opacity: 0;
        transform: translateX(-100%);
        z-index: 0;
    }

    .slide h2 {
        color: #1DB954;
        font-size: 2.5em;
        margin-bottom: 1em;
        text-align: center;
    }

    .card-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1.5em;
        padding: 1.5em;
    }

    .card {
        background: #333;
        color: white;
        padding: 1em;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s, opacity 0.3s;
        max-width: 200px;
        flex: 1 1 calc(33.33% - 2em);
    }

    .card:hover {
        transform: translateY(-5px);
        background: #444;
    }

    /* Navigation Buttons */
    .navigation {
        display: flex;
        justify-content: center;
        gap: 1em;
        margin: 2em 0;
        flex-wrap: wrap;
    }

    .nav-button {
        background: #1DB954;
        color: white;
        border: none;
        padding: 1em 2em;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.3s;
    }

    .nav-button:hover {
        background: #1ed760;
        transform: scale(1.05);
    }

    /* Slide Indicators */
    .slide-indicators {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5em;
        margin-top: 1em;
        position: absolute;
        bottom: 1em;
        left: 0;
        width: 100%;
        z-index: 2; /* Ensures indicators are above slides */
    }

    .indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #888;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .indicator.active {
        background: #1DB954;
    }

    /* Top Navigation Bar */
    .top-nav {
        background: #191414;
        padding: 1em;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border-radius: 0 0 10px 10px;
        font-size: 1.2em;
        font-weight: bold;
        color: #1DB954;
    }

    .dark-mode-button {
        background: #1DB954;
        color: #191414;
        border: none;
        padding: 0.5em 1em;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        margin-left: 1em;
    }

    .dark-mode-button:hover {
        background: #1ed760;
    }

    /* Language Switcher Styles */
    .language-switcher {
        display: flex;
        align-items: center;
        margin-left: 1em;
    }

    .language-switcher select,
    .language-switcher button {
        background: #1DB954;
        color: #ffffff;
        border: none;
        padding: 0.5em 1em;
        border-radius: 25px;
        cursor: pointer;
        margin-left: 0.5em;
    }

    .language-switcher select {
        padding-right: 2em;
    }

    .language-switcher button:hover,
    .language-switcher select:hover {
        background: #1ed760;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .slide h2 {
            font-size: 2em;
        }

        .card {
            flex: 1 1 calc(50% - 2em);
        }
    }

    @media (max-width: 600px) {
        .top-nav {
            flex-direction: column;
            align-items: flex-start;
        }

        .dark-mode-button {
            margin-left: 0;
            margin-top: 1em;
        }

        .language-switcher {
            margin-left: 0;
            margin-top: 1em;
        }

        .slide h2 {
            font-size: 1.5em;
        }

        .card {
            flex: 1 1 100%;
        }

        .nav-button {
            padding: 0.8em 1.5em;
            font-size: 0.9em;
        }

        .navigation {
            flex-direction: column;
            gap: 0.5em;
        }

        /* Adjust slide indicators */
        .slide-indicators {
            bottom: 0.5em;
        }

        .indicator {
            width: 10px;
            height: 10px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="top-nav">
    {% trans "Your Spotify Wrapped" %}
    <button id="dark-mode-toggle" class="dark-mode-button">{% trans "Toggle Dark Mode" %}</button>
    <!-- Language Switcher Form -->
    <form action="{% url 'set_language' %}" method="post" class="language-switcher">
        {% csrf_token %}
        <input name="next" type="hidden" value="{{ request.path }}">
        <select name="language">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for lang in LANGUAGES %}
                <option value="{{ lang.0 }}"{% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>
                    {{ lang.1 }}
                </option>
            {% endfor %}
        </select>
        <button type="submit">{% trans "Switch Language" %}</button>
    </form>
</div>

<div class="slider-container">
    <!-- Slide 1: Your Top Tracks -->
    <div class="slide active">
        <h2>{% trans "Your Top Tracks" %}</h2>
        <div class="card-grid">
            {% for track in wrap_data.top_tracks %}
                <div class="card">
                    <strong>{{ track.name }}</strong><br>
                    {% trans "by" %} {{ track.artist }}
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Slide 2: Your Top Artists -->
    <div class="slide">
        <h2>{% trans "Your Top Artists" %}</h2>
        <div class="card-grid">
            {% for artist in wrap_data.top_artists %}
                <div class="card">
                    <strong>{{ artist.name }}</strong>
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Slide 3: Your Top Genres -->
    <div class="slide">
        <h2>{% trans "Your Top Genres" %}</h2>
        <div class="card-grid">
            {% for genre in wrap_data.top_genres %}
                <div class="card">{{ genre }}</div>
            {% endfor %}
        </div>
    </div>
    <!-- Slide 4: Recently Played Tracks -->
    <div class="slide">
        <h2>{% trans "Recently Played Tracks" %}</h2>
        <div class="card-grid">
            {% for item in wrap_data.recently_played %}
                <div class="card">
                    <strong>{{ item.track }}</strong><br>
                    {% trans "by" %} {{ item.artist }}
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Slide 5: Your Favorite Album -->
    <div class="slide">
        <h2>{% trans "Your Favorite Album" %}</h2>
        <div class="card-grid">
            <div class="card">
                <strong>{{ wrap_data.favorite_album.name }}</strong><br>
                {% trans "by" %} {{ wrap_data.favorite_album.artist }}<br>
                {% trans "Total Plays:" %} {{ wrap_data.favorite_album.play_count }}
            </div>
        </div>
    </div>
    <!-- Slide 6: Your Listening Habits -->
    <div class="slide">
        <h2>{% trans "Your Listening Habits" %}</h2>
        <div class="card-grid">
            <div class="card">
                {% trans "Total Minutes Listened:" %} {{ wrap_data.total_minutes }}
            </div>
            <div class="card">
                {% trans "Total Songs Played:" %} {{ wrap_data.total_tracks }}
            </div>
            <div class="card">
                {% trans "Average Song Duration:" %} {{ wrap_data.average_song_duration }} {% trans "minutes" %}
            </div>
        </div>
    </div>
    <!-- Slide 7: Your Audio Aura -->
    <div class="slide">
        <h2>{% trans "Your Audio Aura" %}</h2>
        <div class="card-grid">
            <div class="card">
                {% trans "Energy Level:" %} {{ wrap_data.audio_features.energy }}%
            </div>
            <div class="card">
                {% trans "Danceability:" %} {{ wrap_data.audio_features.danceability }}%
            </div>
            <div class="card">
                {% trans "Acousticness:" %} {{ wrap_data.audio_features.acousticness }}%
            </div>
            <div class="card">
                {% trans "Valence (Positivity):" %} {{ wrap_data.audio_features.valence }}%
            </div>
        </div>
    </div>
    <!-- Slide 8: Your Top Podcasts -->
    <div class="slide">
        <h2>{% trans "Your Top Podcasts" %}</h2>
        <div class="card-grid">
            {% for podcast in wrap_data.top_podcasts %}
                <div class="card">
                    <strong>{{ podcast.name }}</strong><br>
                    {% trans "Episodes Listened:" %} {{ podcast.episodes_listened }}
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Slide Indicators -->
    <div class="slide-indicators"></div>
</div>

<div class="navigation">
    <button id="prev-slide" class="nav-button">{% trans "Previous" %}</button>
    <button id="next-slide" class="nav-button">{% trans "Next" %}</button>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const slides = document.querySelectorAll('.slide');
        const indicatorsContainer = document.querySelector('.slide-indicators');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        let currentSlide = 0;

        // Create indicators
        slides.forEach((_, index) => {
            const indicator = document.createElement('div');
            indicator.classList.add('indicator');
            if (index === 0) indicator.classList.add('active');
            indicator.addEventListener('click', () => goToSlide(index));
            indicatorsContainer.appendChild(indicator);
        });

        const indicators = document.querySelectorAll('.indicator');

        function showSlide(index) {
            slides.forEach((slide, slideIndex) => {
                if (slideIndex === index) {
                    slide.classList.add('active');
                    slide.classList.remove('inactive');
                } else if (slideIndex < index) {
                    slide.classList.add('inactive');
                    slide.classList.remove('active');
                } else {
                    slide.classList.add('inactive');
                    slide.classList.remove('active');
                }
            });

            indicators.forEach((indicator, indicatorIndex) => {
                indicator.classList.toggle('active', indicatorIndex === index);
            });

            currentSlide = index;
        }

        function goToSlide(index) {
            currentSlide = index;
            showSlide(currentSlide);
        }

        document.getElementById('next-slide').addEventListener('click', function () {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        });

        document.getElementById('prev-slide').addEventListener('click', function () {
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(currentSlide);
        });

        // Dark mode toggle
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
        }

        darkModeToggle.addEventListener('click', function () {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
        });

        // Initial load
        showSlide(currentSlide);
    });
</script>
{% endblock %}
